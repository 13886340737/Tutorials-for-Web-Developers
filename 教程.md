<h2>Unix/Linux Shell编程极简入门实践</h2>

<h4>写在前面</h4>

<h4>1. Hello World</h4>
（插入运行环境的简单介绍）这个教程的代码均在Mac OS下测试过，由于各种shell的标准差别很小，在别的平台比如Ubuntu应该也都能顺利运行。

首先打开你用得最顺手的文本编辑器，在第一、二行分别打入

```
#!/bin/bash
echo "Hello, World!"
```

保存文件，文件可保存在你喜欢的文件夹，扩展名选择`.sh`，比如这样的文件：`tutorial.sh`。

接着，打开命令行工具Terminal，将工作目录改到你保存文件的文件夹，比如如果你将`tutorial.sh`放在`/Users/Steven/code`,则在命令行里执行以下操作

```
cd /Users/Steven/code
chmod +x tutorial.sh
```

第一行命令里面的`cd`是change directory的意思，因为我们要执行`tutorial.sh`这个脚本，所以我们要先将工作目录转到这个脚本对应的文件夹下面。第二行命令`chmod`是change mode，`+x`的意思是将`tutorial.sh`变为一个可执行的文件。

接下来，我们就可以运行`tutorial.sh`这个脚本了。在命令行里打入

```
./tutorial.sh
```

如无意外，你将看到命令行里返回`Hello, World!`这个字符串！请注意，文件名前面的`./`是必不可少的，它告诉系统，就在当前的目录查找一个叫tutorial.sh的文件，如果没有`./`，系统会只在系统目录里面查找（准确来说是PATH变量定义的路径）。

我们回头来看看`tutorial.sh`里面的程序，目前它只有两行：

```
#!/bin/bash
echo "Hello, World!"
```

`#!`是一个标记，它告诉系统该去哪里去寻找能“解释”`tutorial.sh`的解释器。
`echo`是回响的意思，意思是说`echo`后面的那一串东西，都会在命令行显示出来。它和其它语言的`print`是类似的。

就这样，我们完成了一个最简单的bash scripting的程序编写。这里面有几点需要注意：

<ul>
<li>执行脚本文件前，先要cd到文件所在的目录；</li>
<li>执行脚本文件前，先要chmod +x tutorial.sh将其变为可执行程序；</li>
<li>脚本文件的第一行，记得写上#!/bin/bash。</li>
</ul>

<h4>2. 整数和字符串</h4>

变量的定义很简单，按照以下格式就可以了：

```
NAME=var
```

比如定义一个字符串：

```
NAME='Steven'
```

比如定义一个整型变量：

```
NUM=3
```

这里有几点要注意，一是变量的名字，虽然大小写不限，但按照惯例一般采用全大写的方式。第二点特别重要，让我们做一个小实验来说明一下。打开刚才的那个`tutorial.sh`文件，将之前的内容清空，并打入

```
#!/bin/bash
NAME = 'Steven'
echo $NAME
```

如果你是直接复制以上的代码段，那么命令行应该会出现以下错误信息：

```
./tutorial.sh: line 2: NAME: command not found
```

出现这个错误，是因为：定义变量时，`=`的前面和后面，都是不能有空格的！这一点可能和其它语言不一样，但请务必注意。因为出现这类错误时，报错信息定位的栏数（line 2），是指向你引用变量的那一段代码，而不是定义变量的那一行，因此debug起来可能不是那么直观。

于是，我们把代码改为：

```
#!/bin/bash
NAME='Steven'
echo $NAME
```

命令行将显示`Steven`。

从上面的例子我们也可以看到，当你定义了一个变量，要引用它时，要在前面加上`$`。变量名两边可以加上方括号，比如这样`${NAME}`。花括号不是必须的，但最好养成加上的习惯。因为在某些情况下，不加花括号可能引发歧义<a href="https://github.com/qinjx/30min_guides/blob/master/shell.md">[1]</a>:

```
#!/bin/bash
NAME='Steven'
echo "My name is ${NAME}SLXie."
```

可想而知，如果没有花括号，NAME和后面的SLXie就无法区分了。

对于字符串变量，既可以用单括号，比如`'Steven'`，也可以用双括号`"Steven"`，它们之间有微妙而繁杂的区别，在这里我们先记住一点，当字符串里面包含对某个变量的引用时，必须用双括号。比如上面的`"My name is ${NAME}SLXie."`。请试着将它的双括号改为单括号，并观察它的输出结果。

在这里插播一句，看这个教程的时候，最好是看到那里，就动手写到哪里。写的时候，不要直接复制粘贴，而是试着手打代码到编辑器里面。有时候代码里有一些微小而琐碎的东西，一定要自己打一遍才能记得牢。比如，一开始可能容易将`#!/bin/bash`打成`#/bin/bash`，或者`#!bin/bash`。

花括号`{}`也可以用来对字符串进行某些操作。比如下面这个例子：

```
#!/bin/bash
USERNAME='StevenSLXie'
echo "My name is ${USERNAME}. People usually call me ${USERNAME:0:6}."
```

它会输出：

`My name is StevenSLXie. People usually call me Steven.`

这时候，`${USERNAME:0:6}`的作用是取字符串的一部分。第一个数字0是指截取的起始部分，则第二个数字6则是指截取的长度。再比如`${#USERNAME}`则是获取字符串的长度。更多的字符串用法，我们将在后面的正则表达式哪一节看到更多。

<h4>3. 数组</h4>
数组可以这样简单粗暴地定义：

```
NAMES[0]='Steven'
NAMES[1]='Peter'
NAMES[2]='David'
```

当数组体量太大时，这样定义未免麻烦，因此我们也可以用一行声明的方式来定义：

```
declare -a NAMES=('Steven' 'Peter' 'David')
```

用`declare -a`来声明，后面一次性定义所有数组元素。请注意，在这里，整个数组用小括号括起来，而每个数组元素之间，是用空格来隔开的，而不是逗号或者其它。

访问数组的其中一个元素，和其它语言没什么不同。在你声明好数组之后，就可以访问数组元素了：

```
echo ${NAMES[0]}
echo ${NAMES[0]}
echo ${NAMES[*]}
```

`${NAMES[*]}`或者`${NAMES[@]}`表示访问所有元素。而`${#NAMES[*]}`则返回数组长度。请注意它和`${#NAMES}`的区别，后者是返回`NAMES`里面第一个元素的长度，相当于`${#NAMES[0]}`。

一个数组声明并定义后，我们仍可以二次定义它，比如下面的代码是在原来的数组基础上再添加一个人名。

```
declare -a NAMES=('Steven' 'Peter' 'David')
echo ${#NAMES[*]}
NAMES=("${NAMES[*]}" 'Nancy')
echo ${NAMES[*]}
```
命令行将返回：
```
3
Steven Peter David Nancy
```

<h4>4. 运算符</h4>
<h5>4.1 算术运算符</h5>
Shell编程里的算术运算符和大多数编程语言很类似，主要是这些`+ - * / %`等。如果你试着在命令行里执行运算的话，比如输入以下算式：
```
2 + 2
```

会得到：

```
-bash: 2: command not found
```

这条错误信息。这是因为命令行的逻辑是它会把一行命令的第一个词当作是命令，在系统中寻找与之匹配的执行语句，因为在这里它会认为2是一个命令，而显然它不可能找到这个命令。要想执行运算，我们在命令行里打入

```
expr 2 + 2
```

输出结果是`4`。`expr`是一个常用命令，evaluate an expression的意思。注意，这里数字和运算符之间，必须有一个空格。不然的话，如果你输入，
```
expr 2+2
```

则会输出
```
2+2
```

这种情况下，`expr`会把后面的`2+2`当成一个字符串，而evaluate一个字符串的结果，自然就是它本身了。其它的算术运算符大体类似，但有一个要特别注意，如果你进行乘法运算，比如:

```
expr 2 * 15
```

会输出：

```
expr: syntax error
```

这是因为`*`是一个特殊的字符（后面还会介绍到），而当要表达其原来的意思是，我们需要在它前面加上下划线`\`。就像这样：
```
expr `2 \* 15`
```




<h4>4. 条件判断</h4>
<h4>5. while循环</h4>
<h4>6. for循环</h4>
<h4>7. 替换</h4>
<h4>8. 特殊字符</h4>
<h4>9. 输出输入</h4>
<h4>10. 函数</h4>
<h4>11. 正则表达式</h4>
<h4>12. 写一个脚本吧</h4>
<h4>附录：参考资源</h4>
<ul>
<li><a href="http://www.thegeekstuff.com/2010/06/bash-array-tutorial/">1. Bash Array Tutorial</a></li>
<li><a href="https://github.com/qinjx/30min_guides/blob/master/shell.md">2. Shell脚本编程三十分钟入门</a></li>
<li><a href="http://www.tutorialspoint.com/unix/index.htm">3. Unix Tutorial Point</a></li>
<li><a href="http://linux.about.com/">4. about.com</a></li>
</ul>
